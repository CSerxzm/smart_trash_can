C51 COMPILER V9.54   ALL                                                                   11/16/2019 15:58:37 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ALL
OBJECT MODULE PLACED IN all.OBJ
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE all.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*
   2          è¿çº¿è¯´æ˜:
   3          æ­¥è¿›ç”µæœº28BYJ48 IN1~IN4 æ¥ P2^0~P2^3;
   4          çº¢å¤–é¿éšœæ¨¡å—(å¼€ç›–) æ¥ P2^7;
   5          çº¢å¤–é¿éšœæ¨¡å—(æ»¡æº¢) æ¥ P2^6;
   6          æ¸©åº¦DS18B20 DQ æ¥ P3^7;
   7          çƒŸé›¾æ£€æµ‹MQ-7 DOUT æ¥P2^5;
   8          èœ‚é¸£å™¨ æ¥ P2^4;
   9          */
  10          
  11          #include <reg52.h>
  12          #include<intrins.h>
  13          #define uchar unsigned char
  14          #define uint unsigned int
  15           
  16          uchar code CCW[8]={0x08,0x0c,0x04,0x06,0x02,0x03,0x01,0x09};//é€†æ—¶é’Ÿæ—‹è½¬ç›¸åºè¡¨
  17          uchar code CW[8]={0x09,0x01,0x03,0x02,0x06,0x04,0x0c,0x08};//æ­£æ—¶é’Ÿæ—‹è½¬ç›¸åºè¡¨
  18          //æ•°ç ç®¡
  19          uchar table[]={0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90};
  20          //å¸¦å°æ•°ç‚¹
  21          uchar code table1[]={0x40,0x79,0x24,0x30,0x19,0x12,0x02,0x78,0x00,0x10};
  22          uchar code T_COM[] = {0xfe, 0xfd, 0xfb};//æ•°ç ç®¡ä½ç 
  23          uchar disbuff[3]={0,0,0};
  24          uint temp=0;//æ¸©åº¦å€¼ 
  25          sbit OUT0=P2^7;//è·ç¦»æ„Ÿåº”äººæ˜¯å¦é è¿‘
  26          sbit OUT1=P2^6;//æ»¡æº¢æ£€æµ‹ï¼Œå½“æ»¡äº†åèœ‚é¸£å™¨å“èµ·
  27          sbit FMQ=P2^4; //èœ‚é¸£å™¨
  28          sbit K1=P3^3;  //å¤ä½æŒ‰é”®
  29          sbit DOUT=P2^5;  //MQ-7
  30          sbit DS =P3^7;    //DS18B20æ¥P3^6å£
  31          uint flag,j=0;
  32          
  33          void delayMS(uint a){//å»¶æ—¶aæ¯«ç§’
  34   1        uchar b;
  35   1        while(a--){
  36   2         for(b=0;b<115;b++);
  37   2        }
  38   1      }
  39          void delayS(uint a){//å»¶æ—¶aç§’
  40   1          uchar b,c,d;
  41   1        for(;a>0;a--){
  42   2          for(c=167;c>0;c--)
  43   2                for(b=171;b>0;b--)
  44   2                    for(d=16;d>0;d--);
  45   2        }
  46   1      }
  47          /*------------------------èœ‚é¸£å™¨æ¨¡å—------------------------*/
  48          //å½“æ¸©åº¦è¿‡é«˜ã€æ»¡æº¢å’Œæœ‰æ¯’æ°”ä½“æ—¶å°±ä¼šå“èµ·ï¼ŒK4(JD51)ç”¨äºå¤ä½
  49          void delay500us(void){//å»¶æ—¶500us
  50   1        int j;
  51   1        for(j=0;j<57;j++);
  52   1      }
  53          void beep(void){//èœ‚é¸£å™¨
  54   1        uchar t;
  55   1        flag=1;
C51 COMPILER V9.54   ALL                                                                   11/16/2019 15:58:37 PAGE 2   

  56   1        while(flag){
  57   2          for(t=0;t<100;t++){
  58   3            delay500us();
  59   3          FMQ=!FMQ;
  60   3          }
  61   2          if(K1==0){
  62   3          flag=0;
  63   3          }
  64   2          FMQ=1;
  65   2        }
  66   1      }
  67          /*------------------------æ­¥è¿›ç”µæœºæ¨¡å—------------------------*/
  68          void motor_ccw(void){//é€†æ—¶é’ˆæ—‹è½¬
  69   1        uchar i,j;
  70   1        for(j=0;j<8;j++){//ç”µæœºå†…éƒ¨æ—‹è½¬ä¸€å‘¨
  71   2          for(i=0;i<8;i++){//æ—‹è½¬45åº¦
  72   3            P1=CCW[i];
  73   3          delayMS(2);//è°ƒèŠ‚è½¬é€Ÿ
  74   3          }
  75   2        }
  76   1      }
  77          
  78          void motor_cw(void){//é¡ºæ—¶é’ˆæ—‹è½¬
  79   1        uchar i,j;
  80   1        for(j=0;j<8;j++){
  81   2          for(i=0;i<8;i++){
  82   3            P1=CW[i];
  83   3          delayMS(2);
  84   3          }
  85   2        }
  86   1      }
  87          
  88          /*------------------------æ¸©åº¦------------------------*/
  89          void Delay_us(uchar us)
  90          {
  91   1        while(us--);  
  92   1      }
  93          
  94          /*å•æ€»çº¿åˆå§‹åŒ–æ—¶åº*/
  95          bit ds_init()
  96          {
  97   1        bit i;
  98   1        DS = 1;
  99   1        _nop_();
 100   1        DS = 0;
 101   1        Delay_us(75); //æ‹‰ä½æ€»çº¿499.45us æŒ‚æ¥åœ¨æ€»çº¿ä¸Šçš„18B20å°†ä¼šå…¨éƒ¨è¢«å¤ä½
 102   1        DS = 1; //é‡Šæ”¾æ€»çº¿
 103   1        Delay_us(4); //å»¶æ—¶37.95us ç­‰å¾…18B20å‘å›å­˜åœ¨ä¿¡å·
 104   1        i = DS;
 105   1        Delay_us(20); //141.95us
 106   1        DS = 1;
 107   1        _nop_();
 108   1        return (i);
 109   1      }
 110          /*å†™ä¸€ä¸ªå­—èŠ‚*/
 111          void write_byte(uchar dat)
 112          {
 113   1        uchar i;
 114   1        for(i=0;i<8;i++)
 115   1        {
 116   2          DS = 0;
 117   2          _nop_();//äº§ç”Ÿäº›æ—¶åº
C51 COMPILER V9.54   ALL                                                                   11/16/2019 15:58:37 PAGE 3   

 118   2          DS = dat & 0x01;
 119   2          Delay_us(10);//76.95us
 120   2          DS = 1; //é‡Šæ”¾æ€»çº¿å‡†å¤‡ä¸‹ä¸€æ¬¡æ•°æ®å†™å…¥
 121   2          _nop_();
 122   2          dat >>= 1;
 123   2        }
 124   1      }
 125          uchar read_byte()
 126          {
 127   1        uchar i, j, dat;
 128   1        for(i=0;i<8;i++)
 129   1        {
 130   2          DS = 0;
 131   2          _nop_();//äº§ç”Ÿè¯»æ—¶åº
 132   2          DS = 1;
 133   2          _nop_();//é‡Šæ”¾æ€»çº¿
 134   2          j = DS;
 135   2          Delay_us(10);//76.95us
 136   2          DS = 1;
 137   2          _nop_();
 138   2          dat = (j<<7)|(dat>>1);  
 139   2        }
 140   1        return (dat);
 141   1      }
 142          
 143          void convert(void){ 
 144   1         disbuff[0]=temp/100;         //åä½
 145   1         disbuff[1]=temp%100/10;      //ä¸ªä½
 146   1         disbuff[2]=temp%10/10;       //å°æ•°ç‚¹åä¸€ä½
 147   1      }
 148          void Display(void)//æ‰«ææ•°ç ç®¡
 149          {
 150   1        P0=0xff;
 151   1        P2=T_COM[j];
 152   1        if(j!=1){
 153   2          P0=table[disbuff[j]];
 154   2        }else{
 155   2          P0=table1[disbuff[j]];
 156   2        }
 157   1        j++;
 158   1        if(j==3)
 159   1          j=0;
 160   1      }
 161          void  zd3() interrupt 3//T1ä¸­æ–­ç”¨æ¥æ‰«ææ•°ç ç®¡
 162          {
 163   1        TH1 = 0x0FE;
 164   1        TL1 = 0x0C;
 165   1        Display(); 
 166   1      }
 167          void  zd1() interrupt 1//T0ä¸­æ–­ç”¨æ¥æµ‹æ¸©åº¦
 168          {
 169   1        uint i;
 170   1        uchar L, M;
 171   1        TH0 = 0x3C;//æµ‹æ¸©åº¦
 172   1        TL0 = 0x0B0;
 173   1        ds_init();//åˆå§‹åŒ–DS18B20
 174   1        write_byte(0xcc);//å‘é€è·³è·ƒROMæŒ‡ä»¤
 175   1        write_byte(0x44);//å‘é€æ¸©åº¦è½¬æ¢æŒ‡ä»¤
 176   1        ds_init();//åˆå§‹åŒ–DS18B20
 177   1        write_byte(0xcc);//å‘é€è·³è·ƒROMæŒ‡ä»¤
 178   1        write_byte(0xbe);//è¯»å–DS18B20æš‚å­˜å™¨å€¼
 179   1        L = read_byte();
C51 COMPILER V9.54   ALL                                                                   11/16/2019 15:58:37 PAGE 4   

 180   1        M = read_byte();
 181   1        i = M;
 182   1        i <<= 8;
 183   1        i |= L;           
 184   1        temp = i * 0.0625 * 10 + 0.5;
 185   1        convert();
 186   1      }
 187          /*------------------------ä¸»å‡½æ•°------------------------*/
 188          void main(void){
 189   1        uchar r;
 190   1        uchar N=16;//å› ä¸ºæ­¥è¿›ç”µæœºæ˜¯å‡é€Ÿæ­¥è¿›ç”µæœºï¼Œå‡é€Ÿæ¯”çš„1/64ï¼Œ64ä¸ºæ—‹è½¬360ï¼Œ16ä¸ºæ—‹è½¬90å
             -º¦
 191   1        TMOD=0x11;
 192   1        TH0 = 0x3C;//æµ‹æ¸©åº¦
 193   1        TL0 = 0x0B0;
 194   1                 
 195   1        TH1 = 0x0FE;
 196   1        TL1 = 0x0C;
 197   1        ET0=1;         //å…è®¸T0ä¸­æ–­
 198   1        TR0=1;         //å¼€å¯å®šæ—¶å™¨
 199   1        ET1=1;         //å…è®¸T1ä¸­æ–­
 200   1        TR1=1;         //å¼€å¯å®šæ—¶å™¨
 201   1      
 202   1        EA=1;        //å¼€å¯æ€»ä¸­æ–­
 203   1        
 204   1        //å»¶æ—¶ä¸‰ç§’ï¼Œæ¸©åº¦é‡‡é›†å®Œæˆ
 205   1        delayS(3);
 206   1        
 207   1        while(1){
 208   2          if(OUT0==0){
 209   3            //æœ‰äººé è¿‘
 210   3              for(r=0;r<N;r++){
 211   4                motor_ccw();  //ç”µæœºé€†è½¬90åº¦
 212   4            }
 213   3            while(!OUT0);//ç›´åˆ°äººç¦»å¼€
 214   3            delayS(5);
 215   3            for(r=0;r<N;r++){
 216   4                motor_cw();  //ç”µæœºæ­£è½¬90åº¦
 217   4            }
 218   3            if(OUT1==0){
 219   4              //åƒåœ¾æ¡¶æ»¡
 220   4              delay500us();//å»¶æ—¶æŠ—å¹²æ‰°
 221   4              if(OUT1==0){
 222   5                 beep();
 223   5              }
 224   4            }
 225   3          }else{
 226   3            P1=0xf0;    //ç”µæœºåœæ­¢
 227   3          }
 228   2          if(DOUT==0||temp>350)//æœ‰å®³æ°”ä½“æµ“åº¦è¿‡é«˜æˆ–æ¸©åº¦è¿‡é«˜
 229   2          {
 230   3            delay500us();//å»¶æ—¶æŠ—å¹²æ‰°
 231   3            if(DOUT==0||temp>350){
 232   4                beep();
 233   4            }
 234   3          }
 235   2         }
 236   1      }          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    693    ----
C51 COMPILER V9.54   ALL                                                                   11/16/2019 15:58:37 PAGE 5   

   CONSTANT SIZE    =     29    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
